# Display popup with sessions picker, moove default session chooser to leader + r
unbind s
bind r choose-tree -sZ
bind-key -n M-s run-shell "sesh connect \"$(
    sesh list -i | fzf-tmux -p 55%,60% --layout=reverse --ansi \
        --no-sort --border-label ' sesh ' --prompt '‚ö°  ' \
        --header '  ^a all ^t tmux ^g configs ^x zoxide ^d tmux kill ^f find' \
        --bind 'tab:down,btab:up' \
        --bind 'ctrl-a:change-prompt(‚ö°  )+reload(sesh list -i)' \
        --bind 'ctrl-t:change-prompt(ü™ü  )+reload(sesh list -t -i)' \
        --bind 'ctrl-g:change-prompt(‚öôÔ∏è  )+reload(sesh list -c -i)' \
        --bind 'ctrl-x:change-prompt(üìÅ  )+reload(sesh list -z -i)' \
        --bind 'ctrl-f:change-prompt(üîé  )+reload(fd -H -d 2 -t d -E .Trash . ~)' \
        --bind 'ctrl-d:execute(tmux kill-session -t {2..})+change-prompt(‚ö°  )+reload(sesh list --icons)'
)\""

# Create a floating scratch session
# bind F if-shell -F '#{==:#{session_name},scratch}' {
#     detach-client
# } {
#     set -gF '@last_session_name' '#S'
#     popup -d '#{pane_current_path}' -xC -yC -w80% -h80% -E 'tmux new -A -s scratch'
# }
#
# # Move current pane from scratch to the current session and focus it
# bind ! if-shell -F '#{!=:#{session_name},scratch}' {
#     break-pane
# } {
#     run-shell 'bash -c "tmux break-pane -s scratch -t \"$(tmux show -gvq '@last_session_name'):\""'
# }
#
# # Just move current pane from the scratch to the current session, without focusing it
# bind @ if-shell -F '#{!=:#{session_name},scratch}' {
#     break-pane -d
# } {
#     run-shell 'bash -c "tmux break-pane -d -s scratch -t \"$(tmux show -gvq '@last_session_name'):\""'
# }

# Toggle scratch popup with  Alt+e (opens/closes)
bind-key -n M-e run-shell '\
  SESSION="_scratch-$(basename "#{pane_current_path}")" && \
  if [ "#{session_name}" = "$SESSION" ]; then \
    tmux detach-client; \
  else \
    tmux display-popup -E -xC -yC -w80% -h80% -d "#{pane_current_path}" \
      "tmux new -A -s $SESSION"; \
  fi'

# Toggle Claude Code popup with Alt+c (opens/closes)
bind-key -n M-c run-shell '\
  SESSION="_claude-$(basename "#{pane_current_path}")" && \
  if [ "#{session_name}" = "$SESSION" ]; then \
    tmux detach-client; \
  else \
    tmux display-popup -E -xC -yC -w80% -h80% -d "#{pane_current_path}" \
      "tmux attach -t $SESSION || tmux new -s $SESSION \"claude\" \; \
       set-option -t $SESSION status off"; \
  fi'
