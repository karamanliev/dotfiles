# Display popup with sessions picker, moove default session chooser to leader + r
unbind s
bind r choose-tree -sZ
bind-key -n M-s run-shell "sesh connect \"$(
    sesh list -i | fzf-tmux -p 55%,60% --layout=reverse --ansi \
        --no-sort --border-label ' sesh ' --prompt '‚ö°  ' \
        --header '  ^a all ^t tmux ^g configs ^x zoxide ^d tmux kill ^f find' \
        --bind 'tab:down,btab:up' \
        --bind 'ctrl-a:change-prompt(‚ö°  )+reload(sesh list -i)' \
        --bind 'ctrl-t:change-prompt(ü™ü  )+reload(sesh list -t -i)' \
        --bind 'ctrl-g:change-prompt(‚öôÔ∏è  )+reload(sesh list -c -i)' \
        --bind 'ctrl-x:change-prompt(üìÅ  )+reload(sesh list -z -i)' \
        --bind 'ctrl-f:change-prompt(üîé  )+reload(fd -H -d 2 -t d -E .Trash . ~)' \
        --bind 'ctrl-d:execute(tmux kill-session -t {2..})+change-prompt(‚ö°  )+reload(sesh list -i)'
)\""

# Toggle scratch popup with Alt+e
bind-key -n M-e run-shell \
  '~/.config/tmux/scripts/toggle-popup.sh "#{session_name}" "#{pane_current_path}" "scratch" \
    "tmux new -A -s #{session_name}_scratch-popup"'

# Toggle Claude Code popup with Alt+c
bind-key -n M-c run-shell \
  '~/.config/tmux/scripts/toggle-popup.sh "#{session_name}" "#{pane_current_path}" "claude" \
    "tmux attach -t #{session_name}_claude-popup || tmux new -s #{session_name}_claude-popup \"claude\" \; set-option -t #{session_name}_claude-popup default-command \"claude\""'

# Toggle yazi split with Alt+y
bind-key -n M-y run-shell \
  '~/.config/tmux/scripts/yazi-split.sh "#{session_name}" "#{window_index}" "#{pane_current_path}"'

# Toggle lazygit popup with Alt+l
bind-key -n M-l run-shell \
  '~/.config/tmux/scripts/toggle-popup.sh "#{session_name}" "#{pane_current_path}" "lazygit" \
    "~/.config/tmux/scripts/lazygit-popup.sh #{session_name} #{window_index}"'

# Toggle status bar for popup sessions (hide when single window, show when multiple)
set-hook -g after-new-window 'run-shell "~/.config/tmux/scripts/toggle-status.sh"'
set-hook -g after-kill-pane 'run-shell "~/.config/tmux/scripts/toggle-status.sh"'
set-hook -g session-created 'run-shell "~/.config/tmux/scripts/toggle-status.sh"'
